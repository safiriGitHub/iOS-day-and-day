
iOS 触摸相关

触摸事件由触屏生成后如何传递到当前应用？
应用接收触摸事件后如何寻找最佳响应者？实现原理？
触摸事件如何沿着响应链流动？
响应链、手势识别器、UIControl之间对于触摸事件的响应有着什么样的瓜葛？

### hitTest:withEvent: 代码
```
// 什么时候调用:只要事件一传递给一个控件，那么这个控件就会调用自己的这个方法
// 作用:寻找并返回最合适的view
// UIApplication -> [UIWindow hitTest:withEvent:]寻找最合适的view告诉系统
// point:当前手指触摸的点
// event:触摸事件
- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event{
   // 判断自己能否接收事件
    if (self.userInteractionEnabled == NO || self.alpha <= 0.01 || self.hidden == YES) {
        return nil;
    }
    
    // 判断点是不是在当前视图上
    if (![self pointInside:point withEvent:event]) {
        return nil;
    }
    
    // 从后往前遍历自己的子控件，寻找更合适的View
    for (long i = self.subviews.count - 1; i >= 0; i--) {
        // 获取子控件
        UIView *childView = self.subviews[i];
        
        // 将自己坐标系的点转化成子控件坐标系的点
        CGPoint childPoint = [self convertPoint:point toView:childView];
        
        // 递归调用hitTest方法，寻找更加合适的View
        UIView *fitView = [childView hitTest:childPoint withEvent:event];
        if (fitView) {
            return fitView;
        }
    }
    
    // 没有找到比自己更适合的View
    return self;
}
// 作用:判断下传入过来的点在不在方法调用者的坐标系上
// point:是方法调用者坐标系上的点
- (BOOL)pointInside:(CGPoint)point withEvent:(UIEvent *)event
{
     return NO;
}

```

### 重写 hitTest:withEvent: 方法实用之处
#### 拦截事件的处理
    正因为hitTest：withEvent：方法可以返回最合适的view，所以可以通过重写hitTest：withEvent：方法，返回指定的view作为最合适的view。
    不管点击哪里，最合适的view都是hitTest：withEvent：方法中返回的那个view。
    通过重写hitTest：withEvent：，就可以拦截事件的传递过程，想让谁处理事件谁就处理事件。

代码例子：
```
//BView是一个view的子视图
//BView是UIButton的父视图，但是BView的userInteractionEnable= NO
//通过hitTest可以拦截事件的功能 就可以指定UIButton作为响应者。
- (UIView *)hitTest:(CGPoint)point withEvent:(UIEvent *)event
{
    for (UIView *v  in self.subviews) {
        if ([v isKindOfClass:NSClassFromString(@"BView")]) {
            for (UIView *vv  in v.subviews) {
                if ([vv isKindOfClass:NSClassFromString(@"UIButton")]) {
                    CGPoint insideP = [self convertPoint:point toView:vv];
                    BOOL isInsidePoint =  [vv pointInside:insideP withEvent:event];
                    if (isInsidePoint) {
                        return vv;
                        break;
                    }
                }
            }
            break;
        }
    }
    return self;
}
```
####  return nil作用

return nil的含义：

hitTest：withEvent：中return nil的意思是调用当前hitTest：withEvent：方法的view不是合适的view，子控件也不是合适的view。

**特殊用法**

谁都不能处理事件，窗口也不能处理:
    >> 重写window的hitTest：withEvent：方法return nil

只能有窗口处理事件:
    >>控制器的view的hitTest：withEvent：方法return nil或者window的hitTest：withEvent：方法return self
